<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
</head>
<body>
    <h1>Real-Time Suricata Dashboard</h1>

    <h2>Alerts Over Time</h2>
    <canvas id="lineChart"></canvas>

    <h2>Classification Distribution</h2>
    <canvas id="pieChart"></canvas>

    <script>
        var socket = io();

        var ctxLine = document.getElementById("lineChart").getContext("2d");
        var lineChart = new Chart(ctxLine, {
            type: "line",
            data: { labels: [], datasets: [{ label: "Alerts", data: [], borderColor: "red", borderWidth: 2 }] },
            options: { responsive: true, scales: { x: { type: "time", time: { unit: "minute" } }, y: { beginAtZero: true } } }
        });

        var ctxPie = document.getElementById("pieChart").getContext("2d");
        var pieChart = new Chart(ctxPie, {
            type: "pie",
            data: { labels: [], datasets: [{ data: [], backgroundColor: ["red", "blue", "green", "yellow", "purple"] }] },
            options: { responsive: true }
        });

        function updateCharts() {
            fetch("/api/chart-data")
                .then(response => response.json())
                .then(data => {
                    if (!data.error) {
                        lineChart.data.labels = data.timestamps;
                        lineChart.data.datasets[0].data = data.alert_counts;
                        lineChart.update();
                    }
                });

            fetch("/api/pie-data")
                .then(response => response.json())
                .then(data => {
                    if (!data.error) {
                        pieChart.data.labels = data.labels;
                        pieChart.data.datasets[0].data = data.data;
                        pieChart.update();
                    }
                });
        }

        setInterval(updateCharts, 5000);

        socket.on("update_charts", function() {
            updateCharts();
        });
    </script>
</body>
</html>
