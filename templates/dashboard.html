<script>
    // Create the line chart
    const lineCtx = document.getElementById('lineChart').getContext('2d');
    const lineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            scales: {
                y: {
                    ticks: {
                        stepSize: 1  // Y-axis increments in whole numbers
                    }
                }
            }
        }
    });

    // Create the pie chart
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    const pieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: [],
            datasets: [{
                data: [],
                backgroundColor: ['#FF5733', '#33FF57', '#3357FF', '#FF33A6'],
                borderColor: '#fff',
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            // Add percentage sign to the tooltip
                            return tooltipItem.label + ': ' + tooltipItem.raw.toFixed(2) + '%';
                        }
                    }
                }
            }
        }
    });

    function updateCharts() {
        fetch('/api/chart-data')
            .then(response => response.json())
            .then(data => {
                // Update line chart data
                lineChart.data.labels = data.timestamps;  // Timestamps are now grouped
                lineChart.data.datasets = [];
                for (var eventType in data.datasets) {
                    lineChart.data.datasets.push({
                        label: eventType,
                        data: data.datasets[eventType],
                        borderColor: '#' + Math.floor(Math.random()*16777215).toString(16),
                        fill: false,  // No fill under the line
                        lineTension: 0.4  // Smooth the lines
                    });
                }
                lineChart.update();
            });

        fetch('/api/pie-data')
            .then(response => response.json())
            .then(data => {
                // Update pie chart data
                pieChart.data.labels = data.labels;  // Event types
                pieChart.data.datasets[0].data = data.percentages;  // Numeric percentages (without the % sign)
                pieChart.update();
            });
    }

    // Socket.io listener for real-time updates
    const socket = io();
    socket.on('update_charts', function() {
        updateCharts();
    });

    // Initial data load
    updateCharts();
</script>
